<div class="container-fluid order-edit">
    <div class="left-pane-controls">
        <div class="well container-fluid">
            <div>
                <button data-ng-click="save()" class="btn btn-success width-160px">Save</button>
            </div>
            <div class="btn-group margin-top-10px">
                <button ui-sref="index.oneCol.manageOrders" class="btn btn-default width-160px">Cancel</button>
            </div>
        </div>
    </div>
    <div class="right-pane-main">
        <div class="container-fluid">
            <div class="row">
                <span class="legend">
                    <span data-ng-if="legend.CustomerName" class="item">Customer: {{legend.CustomerName}}</span>
                    <span data-ng-if="legend.CustomerId" class="item">Customer ID: {{legend.CustomerId}}</span>
                    <span data-ng-if="legend.OrderId" class="item">Order ID: {{legend.OrderId}}</span>
                    <span data-ng-if="legend.OrderDate" class="item">Order Date: {{legend.OrderDate}}</span>
                    <span data-ng-if="legend.OrderStatus" class="item">Status: {{legend.OrderStatus}}</span>
                </span>
            </div>
            <div class="row">
                <tabset>
                    <tab heading="{{mainTab.name}}" active="mainTab.active">
                        <div class="container container-left xbig-container">
                            <div class="well row">
                                <spinner-overlay data-loading="refreshTracker.active()">
                                    <div class="col-md-12">
                                        <div class="options-row form-horizontal">
                                            <label class="checkbox-inline">
                                                <input type="checkbox" data-ng-model="order.OnHold">Hold Order
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" data-ng-model="order.AutoShipOrder">Auto-Ship Order
                                                <select data-ng-if="order.AutoShipOrder" class="form-control auto-ship-frequency" name="AutoShipOrderFrequency" data-ng-model="order.AutoShipOrderFrequency" ng-options="autoShipOrderFrequency.Key as autoShipOrderFrequency.Text for autoShipOrderFrequency in autoShipOrderFrequencies">
                                                    <option value="" ng-if="false"></option>
                                                </select>
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" data-ng-model="order.IsGift">Gift Order
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" data-ng-model="order.MailOrder">Mail Order
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-12 products-buttons">
                                        <button data-ng-click="productAdd()" class="btn btn-primary-orange width-160px">Add Product</button>
                                        <button data-ng-click="topPurchasedProducts()" class="btn btn-info btn-right width-200px">Top Purchased Products</button>
                                    </div>
                                    <div class="col-md-12 form-horizontal products">
                                        <table class="table table-striped">
                                            <!--<thead>
                                                <tr>
                                                    <th class="sku">SKU</th>
                                                    <th class="type"></th>
                                                    <th class="qty">QTY</th>
                                                    <th class="product-name">Product Name</th>
                                                    <th class="price">Price</th>
                                                    <th class="amount">Amount</th>
                                                    <th class="del">Del</th>
                                                </tr>
                                            </thead>-->
                                            <tbody>
                                                <tr data-ng-class="{warning: item.Messages.length>0}" data-ng-repeat-start="item in order.Products">
                                                    <td class="sku">
                                                        <input name="SKU{{$index}}" class="form-control" placeholder="SKU" data-ng-model="item.SKU">
                                                    </td>
                                                    <td class="type">
                                                        <span data-ng-if="item.IdProductType==2" class="perishable">P</span>
                                                        <span data-ng-if="item.IdProductType==1" class="not-perishable">NP</span>
                                                    </td>
                                                    <td class="qty">
                                                        <input name="QTY{{$index}}" class="form-control" placeholder="" data-ng-model="item.QTY">
                                                    </td>
                                                    <td class="product-name">
                                                        <input name="ProductName{{$index}}" class="form-control" placeholder="Product Name" data-ng-model="item.ProductName">
                                                    </td>
                                                    <td class="price">
                                                        <div class="col-md-12 padding-0px">
                                                            <div class="input-group">
                                                                <span class="input-group-addon">$</span>
                                                                <input type="text" name="Price{{$index}}" class="form-control" placeholder="Price" money min="0.00" max="100000" data-ng-model="item.Price">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="amount">
                                                        <div class="amount">{{item.Amount | currency}}</div>
                                                    </td>
                                                    <td class="del">
                                                        <a class="btn btn-danger btn-xs" title="Delete" data-ng-click="productDelete($index);"><i class="glyphicon glyphicon-remove"></i></a>
                                                    </td>
                                                </tr>
                                                <tr data-ng-repeat-end class="warning" data-ng-if="item.Messages.length>0">
                                                    <td colspan="7">
                                                        <span class="message" data-ng-repeat="message in item.Messages">{{message}}</span>
                                                    </td>
                                                </tr>
                                                <tr class="warning" data-ng-if="order.ProductsPerishableThreshold && !ignoneMinimumPerishableThreshold">
                                                    <td colspan="7">
                                                        <label class="perishable-threshold-message">
                                                            <span>{{minimumPerishableThreshold | currency}} minimum perishable threshold not met. Override</span>
                                                            <input type="checkbox" data-ng-model="ignoneMinimumPerishableThreshold">
                                                        </label>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-md-6 left-section">
                                        <form class="form-horizontal" name="forms.mainForm" data-ng-submit="save()" data-ng-class="{submitted: forms.mainForm.submitted}" novalidate>
                                            <fieldset>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-3 control-label">Source</label>
                                                    <div data-ng-if="order.SourceValue" class="col-md-9 form-control-static">
                                                        <span>{{order.SourceValue}}</span>
                                                    </div>
                                                    <div data-ng-if="!order.SourceValue" class="col-md-9">
                                                        <select class="form-control" name="Source" data-ng-model="order.Source" ng-options="source.Key as source.Text for source in sources">
                                                            <option value="" ng-if="false"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div data-ng-if="!order.SourceValue && order.Source" class="form-group">
                                                    <label for="type" class="col-md-3 control-label">Details</label>
                                                    <div class="col-md-9">
                                                        <input data-ng-if="order.SourceShowText" name="SourceDetailsText" class="form-control" placeholder="Details" data-ng-model="order.SourceDetails">
                                                        <select data-ng-if="order.SourceShowCelebrity" class="form-control" name="SourceDetailsCelebrity" data-ng-model="order.SourceDetails" ng-options="sourceCelebrity.Key as sourceCelebrity.Text for sourceCelebrity in sourceCelebrities">
                                                            <option value="" ng-if="false"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-3 control-label">PO#</label>
                                                    <div class="col-md-9">
                                                        <input name="PO" class="form-control" placeholder="PO#" data-ng-model="order.PO">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-3 control-label">Key Code</label>
                                                    <div class="col-md-9">
                                                        <input name="KeyCode" class="form-control" placeholder="Key Code" data-ng-model="order.KeyCode">
                                                    </div>
                                                </div>

                                                <span class="legend">Ship Delay</span>
                                                <div class="form-group">
                                                    <label class="col-md-12 control-label left">Ship Delay Order?</label>
                                                    <div class="col-md-12">
                                                        <label class="radio-inline"><input data-ng-model="order.ShipDelay" name="ShipDelay" value="0" type="radio">None</label>
                                                        <label class="radio-inline"><input data-ng-model="order.ShipDelay" name="ShipDelay" value="1" type="radio">Entire Order</label>
                                                        <label class="radio-inline"><input data-ng-model="order.ShipDelay" name="ShipDelay" value="2" type="radio">Perishable & Non-Perishable</label>
                                                    </div>
                                                </div>
                                                <div data-ng-if="order.ShipDelay==1" class="form-group">
                                                    <label for="date" class="col-md-6 control-label">Ship Date</label>
                                                    <div class="col-md-6">
                                                        <p class="input-group">
                                                            <input type="text" name="ShipDelayShipDate" class="form-control" datepicker-popup="dd-MMM-yyyy" ng-model="order.ShipDelayShipDate" is-open="shipDelayShipDateOpened" required />
                                                            <span class="input-group-btn">
                                                                <button type="button" class="btn btn-default" ng-disabled="false" ng-click="stopPropagation($event); shipDelayShipDateOpened =true;"><i class="glyphicon glyphicon-calendar"></i></button>
                                                            </span>
                                                        </p>
                                                        <div class="error-container" ng-show="forms.mainForm.submitted && forms.mainForm.ShipDelayShipDate.$invalid">
                                                            <small class="error" ng-show="forms.mainForm.ShipDelayShipDate.$error.required">{{getValidationMessage("ValidationMessages.FieldRequired","GeneralFieldNames.Date")}}</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div data-ng-if="order.ShipDelay==2" class="form-group">
                                                    <label for="date" class="col-md-6 control-label">Perishable Ship Date</label>
                                                    <div class="col-md-6">
                                                        <p class="input-group">
                                                            <input type="text" name="ShipDelayPerishableShipDate" class="form-control" datepicker-popup="dd-MMM-yyyy" ng-model="order.ShipDelayPerishableShipDate" is-open="shipDelayPerishableShipDateOpened" required />
                                                            <span class="input-group-btn">
                                                                <button type="button" class="btn btn-default" ng-disabled="false" ng-click="stopPropagation($event); shipDelayPerishableShipDateOpened =true;"><i class="glyphicon glyphicon-calendar"></i></button>
                                                            </span>
                                                        </p>
                                                        <div class="error-container" ng-show="forms.mainForm.submitted && forms.mainForm.ShipDelayPerishableShipDate.$invalid">
                                                            <small class="error" ng-show="forms.mainForm.ShipDelayPerishableShipDate.$error.required">{{getValidationMessage("ValidationMessages.FieldRequired","GeneralFieldNames.Date")}}</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div data-ng-if="order.ShipDelay==2" class="form-group">
                                                    <label for="date" class="col-md-6 control-label">Non-Perishable Ship Date</label>
                                                    <div class="col-md-6">
                                                        <p class="input-group">
                                                            <input type="text" name="ShipDelayNonPerishableShipDate" class="form-control" datepicker-popup="dd-MMM-yyyy" ng-model="order.ShipDelayNonPerishableShipDate" is-open="shipDelayNonPerishableShipDateOpened" required />
                                                            <span class="input-group-btn">
                                                                <button type="button" class="btn btn-default" ng-disabled="false" ng-click="stopPropagation($event); shipDelayNonPerishableShipDateOpened =true;"><i class="glyphicon glyphicon-calendar"></i></button>
                                                            </span>
                                                        </p>
                                                        <div class="error-container" ng-show="forms.mainForm.submitted && forms.mainForm.ShipDelayNonPerishableShipDate.$invalid">
                                                            <small class="error" ng-show="forms.mainForm.ShipDelayNonPerishableShipDate.$error.required">{{getValidationMessage("ValidationMessages.FieldRequired","GeneralFieldNames.Date")}}</small>
                                                        </div>
                                                    </div>
                                                </div>

                                                <span class="legend">Notes</span>
                                                <div class="form-group">
                                                    <label class="col-md-12 control-label left">Order Specific Notes (*Will appear on invoice)</label>
                                                    <div class="col-md-12">
                                                        <textarea type="text" name="OrderSpecificNotes" class="form-control" placeholder="Order Specific Notes" rows="5" data-ng-model="order.OrderSpecificNotes"></textarea>
                                                    </div>
                                                </div>
                                                <div data-ng-if="order.IsGift" class="form-group">
                                                    <label class="col-md-12 control-label left">Gift Message (*Will appear on invoice)</label>
                                                    <div class="col-md-12">
                                                        <textarea type="text" name="GiftMessage" class="form-control" placeholder="Gift Message" rows="5" data-ng-model="order.GiftMessage"></textarea>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-md-12 control-label left">Delivery Instructions (*Prints to Shipping Label):</label>
                                                    <div class="col-md-12">
                                                        <textarea type="text" name="DeliveryInstructions" class="form-control" placeholder="Delivery Instructions" rows="5" data-ng-model="order.DeliveryInstructions"></textarea>
                                                    </div>
                                                </div>

                                                <span class="legend">Newsletter</span>
                                                <div class="form-group">
                                                    <div class="col-md-12">
                                                        <div class="checkbox">
                                                            <label>
                                                                <input type="checkbox" name="SignUpNewsletter" data-ng-model="order.SignUpNewsletter" /> Sign up for e-newsletter and receive Bonus Offers, Sale Alerts, Recipes, and Health News
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
                                    <div class="col-md-6 right-section">
                                        <form class="form-horizontal" name="forms.mainForm2" data-ng-submit="save()" data-ng-class="{submitted: forms.mainForm2.submitted}" novalidate>
                                            <fieldset>
                                                <div class="form-group margin-bottom-0px">
                                                    <label for="type" class="col-md-7 control-label">Alaska/Hawaii Surcharge</label>
                                                    <div class="col-md-5 form-control-static">
                                                        <span>{{order.AlaskaHawaiiSurcharge | currency}}</span>
                                                    </div>
                                                </div>
                                                <div class="form-group margin-bottom-0px">
                                                    <label for="type" class="col-md-7 control-label">Canada Surcharge</label>
                                                    <div class="col-md-5 form-control-static">
                                                        <span>{{order.CanadaSurcharge | currency}}</span>
                                                    </div>
                                                </div>
                                                <div class="form-group margin-bottom-0px">
                                                    <label for="type" class="col-md-7 control-label">Standard Shipping Charges</label>
                                                    <div class="col-md-5 form-control-static">
                                                        <span>{{order.StandardShippingCharges | currency}}</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Upgrade Perishable Shipping</label>
                                                    <div class="col-md-5">
                                                        <select class="form-control" name="UpgradePerishableShipping" data-ng-model="order.UpgradePerishableShipping" ng-options="upgradePerishableShipping.Key as upgradePerishableShipping.Text for upgradePerishableShipping in upgradePerishableShippings">
                                                            <option value="" ng-if="false"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Upgrade Non-Perishable Shipping</label>
                                                    <div class="col-md-5">
                                                        <select class="form-control" name="UpgradeNonPerishableShipping" data-ng-model="order.upgradeNonPerishableShippings" ng-options="upgradeNonPerishableShippings.Key as upgradePerishableShipping.Text for upgradeNonPerishableShippings in UpgradeNonPerishableShippings">
                                                            <option value="" ng-if="false"></option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Surcharge Override (-)</label>
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-addon">$</span>
                                                            <input type="text" name="SurchargeOverride" class="form-control" placeholder="Surcharge" money min="0.00" max="100000" data-ng-model="order.SurchargeOverride">
                                                        </div>
                                                        <div class="error-container" ng-show="forms.mainForm2.submitted && forms.mainForm2.SurchargeOverride.$invalid">
                                                            <small class="error" ng-show="forms.mainForm2.SurchargeOverride.$error.parse">{{getValidationMessage("ValidationMessages.FieldRequired","GeneralFieldNames.Amount")}}</small>
                                                            <small class="error" ng-show="forms.mainForm2.SurchargeOverride.$error.max">{{getValidationMessage("ValidationMessages.FieldMax","GeneralFieldNames.Amount",1000000)}}</small>
                                                            <small class="error" ng-show="forms.mainForm2.SurchargeOverride.$error.server">{{serverMessages.GetMessage('SurchargeOverride')}}</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Shipping Override (-)</label>
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-addon">$</span>
                                                            <input type="text" name="ShippingOverride" class="form-control" placeholder="Shipping" money min="0.00" max="100000" data-ng-model="order.ShippingOverride">
                                                        </div>
                                                        <div class="error-container" ng-show="forms.mainForm2.submitted && forms.mainForm2.ShippingOverride.$invalid">
                                                            <small class="error" ng-show="forms.mainForm2.ShippingOverride.$error.parse">{{getValidationMessage("ValidationMessages.FieldRequired","GeneralFieldNames.Amount")}}</small>
                                                            <small class="error" ng-show="forms.mainForm2.ShippingOverride.$error.max">{{getValidationMessage("ValidationMessages.FieldMax","GeneralFieldNames.Amount",1000000)}}</small>
                                                            <small class="error" ng-show="forms.mainForm2.ShippingOverride.$error.server">{{serverMessages.GetMessage('ShippingOverride')}}</small>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="form-group margin-bottom-0px">
                                                    <label for="type" class="col-md-7 control-label">Total Shipping</label>
                                                    <div class="col-md-5 form-control-static">
                                                        <span>{{order.TotalShipping | currency}}</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Preferred Ship Method</label>
                                                    <div class="col-md-5">
                                                        <select class="form-control" name="Preferred Ship Method" data-ng-model="order.PreferredShipMethod" ng-options="shipMethod.Key as shipMethod.Text for shipMethod in shipMethods">
                                                            <option value="" ng-if="false"></option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="form-group margin-bottom-0px">
                                                    <label for="type" class="col-md-7 control-label">Product Subtotal</label>
                                                    <div class="col-md-5 form-control-static">
                                                        <span>{{order.ProductSubtotal | currency}}</span>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Discount Code</label>
                                                    <div class="col-md-5">
                                                        <div class="input-group autocomplete">
                                                            <input type="text" name="DiscountCode" class="form-control" placeholder="Discount Code" data-ng-model="order.DiscountCode"
                                                                   typeahead-min-length="1" typeahead="code for code in getDiscounts($viewValue)" typeahead-loading="loadingDiscounts" data-ng-blur="requestRecalculate()"
                                                                   typeahead-on-select="requestRecalculate()" typeahead-wait-ms="100">
                                                        </div>
                                                        <div class="error-container" ng-show="forms.mainForm2.submitted && forms.mainForm2.DiscountCode.$invalid">
                                                            <small class="error" ng-show="forms.mainForm2.DiscountCode.$error.server">{{serverMessages.GetMessage('DiscountCode')}}</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>

                                        <form name="forms.GCs" class="form-horizontal" data-ng-submit="save()" data-ng-class="{submitted: forms.GCs.skussubmitted}" novalidate>
                                            <fieldset>
                                                <div class="form-group">
                                                    <label for="type" class="col-md-7 control-label">Gift Certificate</label>
                                                    <div class="col-md-5">
                                                        <div data-ng-repeat="gc in order.GCs" class="gcs">
                                                            <div class="form-horizontal item" ng-form="i{{$index}}" novalidate>
                                                                <div class="col-md-10 padding-0px">
                                                                    <div class="input-group autocomplete code">
                                                                        <input type="text" name="Code" class="form-control" placeholder="Gift Certificate" data-ng-model="gc.Code"
                                                                               typeahead-min-length="1" typeahead="code for code in getGCs($viewValue)" typeahead-loading="loadingGCs" data-ng-blur="gcLostFocus($index, gc.Code)"
                                                                               typeahead-on-select="requestRecalculate()" typeahead-wait-ms="100">
                                                                    </div>
                                                                    <div class="error-container small-block" ng-show="forms.GCs.skussubmitted && forms.GCs.i{{$index}}.Code.$invalid">
                                                                        <small class="error" ng-show="forms.GCs.i{{$index}}.Code.$error.server">{{serverMessages.GetMessage('Code','GCs',$index)}}</small>
                                                                    </div>
                                                                </div>
                                                                <div data-ng-if="$index==0" class="col-md-2 padding-0px">
                                                                    <a class="btn btn-success btn-xs" title="Add" data-ng-click="gcAdd();"><i class="glyphicon glyphicon-plus"></i></a>
                                                                </div>
                                                                <div data-ng-if="$index!=0" class="col-md-2 padding-0px">
                                                                    <a class="btn btn-danger btn-xs" title="Delete" data-ng-click="gcDelete($index);"><i class="glyphicon glyphicon-remove"></i></a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="total-section">
                                                    <div class="form-group margin-bottom-0px">
                                                        <label for="type" class="col-md-7 control-label">Discount</label>
                                                        <div class="col-md-5 form-control-static">
                                                            <span>{{order.Discount}}%</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group margin-bottom-0px">
                                                        <label for="type" class="col-md-7 control-label">Discount Amount</label>
                                                        <div class="col-md-5 form-control-static">
                                                            <span>{{order.DiscountAmount | currency}}</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group margin-bottom-0px">
                                                        <label for="type" class="col-md-7 control-label">Discounted Subtotal</label>
                                                        <div class="col-md-5 form-control-static">
                                                            <span>{{order.DiscountedSubtotal | currency}}</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group margin-bottom-0px">
                                                        <label for="type" class="col-md-7 control-label">Shipping Total</label>
                                                        <div class="col-md-5 form-control-static">
                                                            <span>{{order.ShippingTotal | currency}}</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group margin-bottom-0px">
                                                        <label for="type" class="col-md-7 control-label">Tax</label>
                                                        <div class="col-md-5 form-control-static">
                                                            <span>{{order.Tax | currency}}</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group margin-bottom-0px">
                                                        <label for="type" class="col-md-7 control-label">Grand Total</label>
                                                        <div class="col-md-5 form-control-static">
                                                            <span>{{order.GrandTotal | currency}}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
                                </spinner-overlay>
                            </div>
                        </div>
                    </tab>
                </tabset>
            </div>
        </div>
    </div>
</div>